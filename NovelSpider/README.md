# 晋江/长佩小说下载器

## 简介

+ 本项目基于python+selenium+phantomjs+chrome实现。
+ 支持模拟登录。
+ 根据提供的小说主页（支持多个）可下载长佩所有小说和晋江所购买的小说
+ 性能不太好，亟待优化。

&nbsp; &nbsp;  &nbsp; 

## 晋江爬虫

 &nbsp;  &nbsp; 晋江的反爬虫机制意外的严格，跟它的UI非常不符。

 &nbsp;  &nbsp; 非vip章节的反爬虫还好，只是在空行中加了很多与背景色相同的乱码，通过正则表达式可以很好地过滤。但是vip章节包括登录机制都还不在我的能力范围内。晋江检验cookie的机制简直是玄学，首先我用phantomjs模拟登录，但晋江有一个自己的检验浏览器是否启用cookie的方法，phantomjs伪装成别的浏览器也无效，遂失败，只能采用效率更低的chrome。然后模拟登录，但是用python传回来的cookie再添加到post里会被识别为过期cookie，无解，最后只能全局使用一个会话，所幸代码上很好解决，但是非常影响效率。



## 长佩爬虫

 &nbsp;  &nbsp; 长佩的爬虫比较简单，从登录到格式处理上都没什么大问题。而且登录没有验证码，cookie的验证也顺利通过了，直接用phantomjs可以直接做完，性能比晋江爬虫快十倍。



## 不足

+ 代码组织乱七八糟
  + 结构上没有好好考虑，这用extend或者implement可以写得条理清晰
  + 没有想到晋江的安全措施这么厉害，把我仅有的代码结构打乱了
  + 常量应该分离出来

+ python的语法坑踩了很多，弱类型的语言ide在提示方面比强类型的差了很多

+ 性能很烂，尤其是晋江的这个，正在优化中，以勉强满足我的使用为标准

  ​

## 优化

* 获取晋江小说页面的时候，经常会加载一万年，但其实小说内容一般在一两秒内就已经加载完成了，这时候我选择给driver加一个超时设置，时间设为2秒，超时后判断小说内容所在的元素是否加载完成，加载完成即停止整个页面的加载，直接获取页面源码即可，否则再重新获取页面。这样一来，获取每个页面小说内容的时间由五秒至一万年不等到了一秒或几秒，极大地优化了爬虫速度。
* 在获取非vip章节时，我原来采用的是phantomjs，但是phantomjs这个没有界面的浏览器其实比有界面的chrome要慢上十倍，果断抛弃换成chrome。